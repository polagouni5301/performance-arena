[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisor/supervisord.pid
user=appuser

# Redirect logs to stdout for Docker
silent=false

[unix_http_server]
file=/var/run/supervisor/supervisor.sock
chmod=0700
chown=appuser:appuser

[supervisorctl]
serverurl=unix:///var/run/supervisor/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# ============ NGINX PROCESS ============
[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
autostart=true
priority=10
stopasgroup=true
stopwaitsecs=5

# ============ BACKEND NODE.JS PROCESS ============
[program:nodejs]
directory=/app/backend
command=node server.js
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
autostart=true
priority=20
stopasgroup=true
stopwaitsecs=10
environment=NODE_ENV="production",PORT=3000

# Process management
[group:webservices]
programs=nginx,nodejs
priority=999
